/*lighteditor*/var codepad=angular.module("codepad",[]);
codepad.factory("keys",[function(){return keymap.create().install(document.body)}]).factory("magicform",function(){return window.magicform}).factory("messageQueue",["$rootScope",function(a){var e={},f={postMessage:function(h,g){e[h]||(e[h]=[]);e[h].push(g);a.$broadcast(h);return f},on:function(a,g,d){a.$on(g,function(){d(e[g].pop())});return f}};return f}]).factory("le",function(){return window.LE}).factory("dialog",function(){return window.dialog}).factory("storage",function(){return{}}).directive("ngLighteditor",
["le",function(a){return{link:function(e,f){a.editor=new a.lightEditor(f[0],{language:"js"})}}}]);
codepad.controller("DialogController",["$scope","$element","$timeout","$compile","messageQueue",function(a,e,f,h,g){var d=e.children()[1],l=e[0].querySelector(".form-content"),k=null,b=function(){var a=d.offsetWidth,b=d.offsetHeight,c=chrome.app.window.current().getBounds();return{left:(c.width-a)/2+"px",top:(c.height-b)/2+"px"}},c=function(c){magicform.generate(l,magicform.attach(c.data,c.config),c.options);h(l)(a);a.show=!0;a.$apply();f(function(){a.position=b();a.visibility="visible";var c=d.getElementsByTagName("input")[0];
f(function(){c.focus();c.select()},0)},0)};a.show=!1;a.visibility="hidden";a.title="\u6e29\u99a8\u63d0\u793a";a.legend="\u4fdd\u5b58\u4ee3\u7801";a.closeDialog=function(){a.show=!1};a.submit=function(){if(k.onsubmit){var b=magicform.detach(magicform.html2json(l),k.config);k.onsubmit(b)&&(a.show=!1)}else a.show=!1};g.on(a,"showDialog",function(a){k=a;c(k)})}]);
codepad.controller("IndexController",["$scope","$element","le","messageQueue","dialog","storage",function(a,e,f,h,g,d){var l=e.find("ul"),k=function(b){chrome.storage.sync.get("codepad.items",function(c){if(c&&c["codepad.items"]&&(a.snippets=c["codepad.items"].category,a.$digest(),b)){c=l.find("li");for(var d=0;d<c.length;d++)angular.element(c[d]).attr("data-name")===b&&c[d].click()}})};a.snippets=[];k();a.selected=function(b){var c=angular.element(b.currentTarget);a.selectedIndex=c.attr("data-index");
(b=a.snippets.filter(function(a){if(a.name===c.attr("data-name"))return a}))&&b[0]&&(d.selectedSnippet=b[0],f.editor.setContent(b[0].content))};a.mouseEnter=function(a){angular.element(a.currentTarget).find("a").removeClass("none")};a.mouseLeave=function(a){angular.element(a.currentTarget).find("a").addClass("none")};a["new"]=function(){a.selectedIndex=-1;f.editor.setContent("");d.selectedSnippet={name:""}};a["delete"]=function(b){var c=angular.element(b.currentTarget),d=c.attr("data-name"),l=g({title:"\u6e29\u99a8\u63d0\u793a",
content:"\u786e\u5b9a\u8981\u5220\u9664\u8be5\u4ee3\u7801\u6bb5\u5417\uff1f",buttons:[{name:"\u5220\u9664",primary:!0,callback:function(){var b=a.snippets.filter(function(a){if(a.name!==d)return a});chrome.storage.sync.set({"codepad.items":{category:b}},function(){var d=c.parent()[0];d&&d.previousElementSibling&&d.previousElementSibling.click();a.snippets=b;a.$digest();l.close()});return!1}},{name:"\u53d6\u6d88"}]})};h.on(a,"updateMenu",function(a){k(a.name)})}]);
codepad.directive("ngKeybind",["keys","messageQueue","le","dialog","storage",function(a,e,f,h,g){return{link:function(){a.bind(["ctrl_s","command_s"],function(){chrome.storage.sync.get("codepad.category",function(a){a&&a["codepad.category"]||(a={"codepad.category":[{text:"\u6536\u85cf\u5939",val:"category"}]});a&&a["codepad.category"]&&(a=a["codepad.category"],e.postMessage("showDialog",{data:{category:a[0]?a[0].val:"",name:g.selectedSnippet&&g.selectedSnippet.name||""},config:{category:{mf:1,control:"select",
label:{title:"\u5206\u7c7b"},options:a},name:{mf:1,label:{title:"\u6587\u4ef6\u540d"},validation:"required"}},options:{status:"editable",hasbuttons:!0,action:"#",buttons:[{name:"\u63d0\u4ea4",title:"\u63d0\u4ea4\u8868\u5355",classname:"primary",attr:"ng-click",submit:!0},{name:"\u53d6\u6d88",title:"\u53d6\u6d88",classname:"normal",attr:"ng-click=closeDialog($event)"}]},onsubmit:function(a){var d=a.category;a.name=a.name.trim();chrome.storage.sync.get("codepad.items",function(b){b&&!b["codepad.items"]&&
(b["codepad.items"]={});if(b&&b["codepad.items"]){b["codepad.items"][d]||(b["codepad.items"][d]=[]);var c=b["codepad.items"][d].filter(function(b){if(b.name===a.name)return b});0===c.length?(b["codepad.items"][d].push({name:a.name,content:f.editor.getRawCode()}),chrome.storage.sync.set(b),e.postMessage("updateMenu",a)):g.selectedSnippet&&g.selectedSnippet===a.name?chrome.storage.sync.set(b):h({title:"\u6e29\u99a8\u63d0\u793a",content:"\u786e\u5b9a\u8981\u8986\u76d6"+a.name+"\u4ee3\u7801\u6bb5\u5417\uff1f",
buttons:[{name:"\u8986\u76d6",primary:!0,callback:function(){c[0].content=f.editor.getRawCode();chrome.storage.sync.set(b);e.postMessage("updateMenu",a);return!0}},{name:"\u53d6\u6d88"}]})}});return!0}}))})})}}}]);codepad.config(function(){});
